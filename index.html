<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0F3188" />
  <meta name="description" content="KADRA — Besprechungsprotokolle für Immobilienprojekte nach AHO-Standard" />
  <title>KADRA</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="96x96" href="icons/favicon.png" />
  <link rel="preload" href="fonts/nunito-sans-v19-latin-regular.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="fonts/nunito-sans-v19-latin-600.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

  <!-- ════════════════════════════════════════════════════════
       PASSWORT-GATE
  ════════════════════════════════════════════════════════ -->
  <div id="loginGate" class="login-gate">
    <div class="login-card">
      <img src="icons/kadra-logo.png" alt="KADRA" class="login-logo" />
      <p class="login-subtitle">Besprechungsprotokolle</p>
      <form id="loginForm" class="login-form" autocomplete="off">
        <input id="loginPassword" type="password" class="login-input"
               placeholder="Passwort" autofocus />
        <button type="submit" class="login-btn">Anmelden</button>
        <p id="loginError" class="login-error hidden">Falsches Passwort</p>
      </form>
    </div>
  </div>

  <div id="app" class="app-shell hidden">

    <!-- ════════════════════════════════════════════════════════
         SEITENLEISTE
    ════════════════════════════════════════════════════════ -->
    <aside id="sidebar" class="sidebar">

      <div class="sidebar-logo">
        <img src="icons/kadra-logo.png" alt="KADRA" class="kadra-logo" />
        <img src="icons/favicon.png" alt="K" class="kadra-favicon" />
      </div>

      <div class="sidebar-header">
        <div class="project-selector-wrap">
          <select id="projectSelect" class="project-select" title="Projekt zur Bearbeitung auswählen">
            <option value="">Projekt wählen</option>
          </select>
          <button id="btnNewProject" class="icon-btn" title="Neues Projekt anlegen">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
            </svg>
          </button>
          <div class="project-menu-wrap">
            <button id="btnProjectMenu" class="icon-btn" title="Projekt-Aktionen">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
              </svg>
            </button>
            <div id="projectMenuPanel" class="project-menu-panel hidden">
              <button id="btnExportFullDB" class="project-menu-item">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                </svg>
                Datenbank exportieren
              </button>
              <button id="btnImportFullDB" class="project-menu-item">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                  <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>
                </svg>
                Datenbank importieren
              </button>
              <button id="btnCloseDatabase" class="project-menu-item danger">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 1a2 2 0 0 0-2 2v.5H3a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-3V3a2 2 0 0 0-2-2M6 3a2 2 0 0 1 4 0v.5H6z"/>
                  <path d="M3 7.5V14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V7.5zm3 1a.5.5 0 0 1 1 0V13a.5.5 0 0 1-1 0zm3 0a.5.5 0 0 1 1 0V13a.5.5 0 0 1-1 0z"/>
                </svg>
                Datenbank schließen
              </button>
              <div class="project-menu-divider"></div>
              <button id="btnExportProject" class="project-menu-item">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                </svg>
                Projekt exportieren
              </button>
              <button id="btnImportProject" class="project-menu-item">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                  <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>
                </svg>
                Projekt importieren
              </button>
              <button id="btnDeleteProject" class="project-menu-item danger">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                  <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H5.5l1-1h3l1 1h2.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                </svg>
                Projekt löschen
              </button>
              <div class="project-menu-divider"></div>
              <button id="btnAppInfo" class="project-menu-item">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                  <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                </svg>
                Info
              </button>
              <button id="btnLogout" class="project-menu-item">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                  <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                </svg>
                Abmelden
              </button>
            </div>
          </div>
        </div>
        <button id="btnToggleSidebar" class="sidebar-toggle" title="Seitenleiste ein-/ausklappen">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"/>
          </svg>
        </button>
      </div>

      <div class="sidebar-quicksave">
        <button id="btnQuickSave" class="btn-quicksave" title="Datenbank speichern">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3.828a1 1 0 0 0-.293-.707l-1.828-1.828A1 1 0 0 0 12.172 1H2zm0 1h1v3.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V2h1.172l1.828 1.828V14H2V2zm3 0v3h5V2H5z"/>
            <path d="M5 9h6a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5v-4A.5.5 0 0 1 5 9zm0 1v3h6v-3H5z"/>
          </svg>
        </button>
        <span id="quickSaveLabel" class="quicksave-label" title="">—</span>
      </div>

      <div class="sidebar-actions">
        <button id="btnNewProtocol" class="btn-new-protocol" disabled>
          <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
          </svg>
          NEUES PROTOKOLL
        </button>
      </div>

      <div class="sidebar-search">
        <svg class="search-icon" width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
        </svg>
        <input type="search" id="searchInput" class="search-input" placeholder="Protokoll suchen …" />
      </div>

      <div class="docs-section-header">
        <span class="docs-label">Dokumente</span>
      </div>

      <div class="sidebar-list-container">
        <div id="protocolList" class="protocol-list">
          <div class="empty-state-sidebar"><p>Kein Projekt ausgewählt.</p></div>
        </div>
      </div>

      <!-- Papierkorb-Panel (überlagert die Protokollliste) -->
      <div id="trashPanel" class="trash-panel hidden">
        <div class="trash-panel-header">
          <h3 class="trash-panel-title">Papierkorb</h3>
          <button id="btnCloseTrash" class="trash-panel-close" title="Schließen">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
              <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
            </svg>
          </button>
        </div>
        <div id="trashProjectList" class="trash-project-list"></div>
        <hr id="trashDivider" class="trash-divider hidden" />
        <div id="trashList" class="trash-list"></div>
      </div>

      <div class="sidebar-footer">
        <button id="btnTrash" class="footer-btn footer-btn-wide" title="Papierkorb anzeigen">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
            <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
          </svg>
          Papierkorb anzeigen
        </button>
      </div>

    </aside>

    <!-- Sidebar Resize Handle -->
    <div id="sidebarResizeHandle" class="sidebar-resize-handle"></div>

    <!-- ════════════════════════════════════════════════════════
         HAUPTBEREICH
    ════════════════════════════════════════════════════════ -->
    <main id="workspace" class="workspace">

      <!-- ── Sticky Toolbar ──────────────────────────────────── -->
      <div id="workspaceToolbar" class="workspace-toolbar hidden">
        <div class="toolbar-left">
          <span class="toolbar-label">TOOLBOX</span>
          <div class="toolbar-divider"></div>

          <!-- Werkzeug-Buttons -->
          <div class="toolbar-tools">
            <div class="chapter-filter-wrap">
              <button id="btnChapterFilter" class="tool-btn" title="Kapitel ein-/ausblenden">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                </svg>
                <span>KAP</span>
              </button>
              <div id="chapterFilterPanel" class="chapter-filter-panel hidden">
                <div class="chapter-filter-header">Kapitel ein-/ausblenden</div>
                <div id="chapterFilterList"></div>
              </div>
            </div>
            <button id="btnAddChapter" class="tool-btn" title="Neues Kapitel hinzufügen (ab F)">
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
              </svg>
              <span>KAP</span>
            </button>
            <button id="btnAddSubchapter" class="tool-btn" title="Neues Unterkapitel im markierten Kapitel einfügen">
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
              </svg>
              <span>UKAP</span>
            </button>
            <button id="btnAddTopic" class="tool-btn" title="Neues Thema im markierten Unterkapitel einfügen (+ erster Punkt)">
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
              </svg>
              <span>THEMA</span>
            </button>
            <button id="btnAddPoint" class="tool-btn" title="Neuer Protokollpunkt im markierten Thema / Unterkapitel">
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
              </svg>
              <span>PKT</span>
            </button>
            <div class="toolbar-divider"></div>
            <div class="point-filter-wrap">
              <button id="btnPointFilter" class="tool-btn tool-btn-icon" title="Punkte filtern">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .39.812L9.5 7.606V13.5a.5.5 0 0 1-.257.437l-3 1.5A.5.5 0 0 1 5.5 15V7.606L.61 1.812A.5.5 0 0 1 1.5 1.5z"/>
                </svg>
              </button>
              <div id="pointFilterPanel" class="point-filter-panel hidden">
                <label class="filter-option">
                  <input type="checkbox" id="filterHideDone" /> Erledigte ausblenden
                </label>
                <div class="filter-separator"></div>
                <label class="filter-option">
                  <input type="checkbox" id="filterOnlyOverdue" /> Nur überfällige
                </label>
                <label class="filter-option">
                  <input type="checkbox" id="filterOnlyNew" /> Nur neue Punkte
                </label>
                <div class="filter-separator"></div>
                <label class="filter-option">
                  <input type="checkbox" id="filterOnlyTasks" /> Nur Aufgaben
                </label>
                <label class="filter-option">
                  <input type="checkbox" id="filterOnlyApproval" /> Nur Freigabe erfordl.
                </label>
              </div>
            </div>
            <button id="btnOpenSearch" class="tool-btn tool-btn-icon" title="Volltextsuche (Ctrl+F)">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
              </svg>
            </button>
            <button id="btnReload" class="tool-btn tool-btn-icon" title="Seite neu laden" onclick="location.reload()">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 1 1 .908-.418A6 6 0 1 1 8 2z"/>
                <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/>
              </svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="btnExportPdf" class="tool-btn" title="PDF exportieren">
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
              </svg>
              <span>PDF</span>
            </button>
            <button id="btnExportXlsx" class="tool-btn" title="Excel exportieren (kommt bald)" disabled>
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M5.18 4.616a.5.5 0 0 1 .704.064L8 7.219l2.116-2.54a.5.5 0 1 1 .768.641L8.651 8l2.233 2.68a.5.5 0 0 1-.768.64L8 8.781l-2.116 2.54a.5.5 0 0 1-.768-.641L7.349 8 5.116 5.32a.5.5 0 0 1 .064-.704"/>
                <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
              </svg>
              <span>XLSX</span>
            </button>

            <!-- Kontext-Anzeige: zeigt welche Zeile gerade aktiv ist -->
            <span id="selectionHint" class="selection-hint"></span>

            <!-- Platz für weitere Werkzeuge -->
            <div class="toolbar-reserved" title="Weitere Werkzeuge folgen"></div>
          </div>
        </div>

        <div class="toolbar-right">
          <button id="btnDeleteProtocol" class="btn-danger btn-sm">
            <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
            </svg>
            Löschen
          </button>
        </div>
      </div>

      <!-- ── Suchleiste ───────────────────────────────────────── -->
      <div id="searchBar" class="search-bar hidden">
        <div class="search-bar-inner">
          <svg class="search-bar-icon" width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
          </svg>
          <input type="text" id="searchBarInput" class="search-bar-input" placeholder="Suchen …" autocomplete="off" />
          <span id="searchBarCount" class="search-bar-count"></span>
          <button id="searchBarPrev" class="search-bar-nav" title="Vorheriger Treffer (Shift+Enter)">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
              <path d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
            </svg>
          </button>
          <button id="searchBarNext" class="search-bar-nav" title="Nächster Treffer (Enter)">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
              <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
            </svg>
          </button>
          <button id="searchBarClose" class="search-bar-close" title="Suche schließen (Escape)">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
              <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- ── Workspace-Inhalt ─────────────────────────────────── -->
      <div class="workspace-content">

        <!-- Leerer Zustand -->
        <div id="emptyState" class="empty-state">
          <div class="empty-state-icon">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
              <rect x="12" y="8" width="40" height="48" rx="4" fill="#E5E7EB"/>
              <rect x="18" y="18" width="28" height="2" rx="1" fill="#9CA3AF"/>
              <rect x="18" y="24" width="20" height="2" rx="1" fill="#9CA3AF"/>
              <rect x="18" y="30" width="24" height="2" rx="1" fill="#9CA3AF"/>
              <rect x="18" y="36" width="16" height="2" rx="1" fill="#9CA3AF"/>
            </svg>
          </div>
          <h2 class="empty-state-title">Kein Protokoll geöffnet</h2>
          <p class="empty-state-text">Wählen Sie ein Projekt und öffnen Sie ein Protokoll<br>oder erstellen Sie ein neues.</p>
        </div>

        <!-- Protokoll-Ansicht -->
        <div id="protocolView" class="protocol-view hidden">

          <!-- Titelblock -->
          <section class="section-card" id="sectionHeader">
            <div class="title-block">
              <div class="title-row">
                <span id="projectBadge" class="project-badge">—</span>
                <h1 id="fieldTitle" class="protocol-title editable" contenteditable="true"
                    data-placeholder="Protokolltitel …"></h1>
                <span class="protocol-number-display"><span id="fieldNumber">01</span></span>
              </div>
              <div class="meta-grid">
                <label class="meta-label">
                  <span class="meta-key">Datum</span>
                  <input type="date" id="fieldDate" class="meta-input" />
                </label>
                <label class="meta-label">
                  <span class="meta-key">Uhrzeit</span>
                  <input type="text" id="fieldTime" class="meta-input" placeholder="z. B. 11:00 – 14:00 Uhr" />
                </label>
                <label class="meta-label">
                  <span class="meta-key">Ort</span>
                  <input type="text" id="fieldLocation" class="meta-input" placeholder="Ort / Format" />
                </label>
                <label class="meta-label">
                  <span class="meta-key">Projekt</span>
                  <input type="text" id="fieldProjectName" class="meta-input meta-input-readonly" readonly />
                </label>
                <label class="meta-label">
                  <span class="meta-key">Mieterin</span>
                  <input type="text" id="fieldTenant" class="meta-input" placeholder="optional" />
                </label>
                <label class="meta-label">
                  <span class="meta-key">Vermieterin</span>
                  <input type="text" id="fieldLandlord" class="meta-input" placeholder="optional" />
                </label>
              </div>
            </div>
          </section>

          <!-- Teilnehmer -->
          <section class="section-card" id="sectionParticipants">
            <h2 class="section-title">Teilnehmer</h2>
            <div class="table-wrapper">
              <table class="data-table participants-table">
                <thead>
                  <tr>
                    <th class="col-name">Name</th>
                    <th class="col-company">Firma / Organisation</th>
                    <th class="col-abbr">Kürzel</th>
                    <th class="col-email">E-Mail-Adresse</th>
                    <th class="col-check">Teilnehmer</th>
                    <th class="col-check">Verteiler</th>
                    <th class="col-action"></th>
                  </tr>
                </thead>
                <tbody id="participantsBody"></tbody>
                <tfoot>
                  <tr class="add-row">
                    <td><input type="text"  id="newParticipantName"    class="table-input" placeholder="Name …" /></td>
                    <td><input type="text"  id="newParticipantCompany" class="table-input" placeholder="Firma …" /></td>
                    <td><input type="text"  id="newParticipantAbbr"    class="table-input" placeholder="Kürzel" maxlength="4" /></td>
                    <td><input type="email" id="newParticipantEmail"   class="table-input" placeholder="E-Mail …" /></td>
                    <td style="text-align:center"><input type="checkbox" id="newParticipantAttended" class="table-checkbox" checked /></td>
                    <td style="text-align:center"><input type="checkbox" id="newParticipantDistrib"  class="table-checkbox" checked /></td>
                    <td>
                      <button id="btnAddParticipant" class="btn-add-row">
                        <svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor">
                          <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
                        </svg>
                        Hinzufügen
                      </button>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </section>

          <!-- Protokollpunkte -->
          <section class="section-card" id="sectionPoints">
            <div class="points-section-header">
              <button id="btnCollapseAll" class="collapse-all-btn" title="Alle Kapitel ein-/ausklappen">
                <svg width="10" height="10" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
              <h2 class="section-title" style="padding:0;margin:0">Protokollpunkte</h2>
            </div>
            <div class="table-wrapper">
              <table class="data-table points-table" id="pointsTable">
                <thead>
                  <tr>
                    <th class="col-collapse"></th>
                    <th class="col-id">ID</th>
                    <th class="col-content">Inhalt</th>
                    <th class="col-category">Kategorie</th>
                    <th class="col-responsible">Zuständig</th>
                    <th class="col-deadline">Termin</th>
                    <th class="col-done">Erledigt</th>
                    <th class="col-action"></th>
                  </tr>
                </thead>
                <tbody id="pointsBody"></tbody>
              </table>
            </div>
          </section>

          <!-- Anlagen -->
          <section class="section-card" id="sectionAttachments">
            <h2 class="section-title">Anlagen</h2>
            <p id="attachmentsEmpty" class="empty-hint">keine Anlagen</p>
            <div class="table-wrapper">
              <table class="data-table attachments-table">
                <thead>
                  <tr>
                    <th class="col-attach-nr">Nr.</th>
                    <th>Inhalt / Bezeichnung</th>
                    <th class="col-attach-file">Datei</th>
                    <th class="col-action"></th>
                  </tr>
                </thead>
                <tbody id="attachmentsBody"></tbody>
              </table>
            </div>
            <div id="attachDropZone" class="attach-dropzone">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="attach-dropzone-icon">
                <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
              </svg>
              <span>Datei hierher ziehen oder</span>
              <button type="button" id="btnPickFile" class="attach-pick-btn">Datei auswählen</button>
            </div>
            <input type="file" id="filePickerInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp,.tiff,.svg" style="display:none" />
            <button id="btnAddAttachment" class="btn-add-bottom">
              <svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"/>
              </svg>
              Leere Anlage
            </button>
          </section>

          <!-- Aufgestellt -->
          <section class="section-card" id="sectionAuthor">
            <h2 class="section-title">Aufgestellt</h2>
            <div class="author-content">
              <div class="author-fields">
                <label class="author-label">
                  <span class="meta-key">Vorname</span>
                  <input type="text" id="fieldAuthorFirstName" class="meta-input" placeholder="Vorname" />
                </label>
                <label class="author-label">
                  <span class="meta-key">Name</span>
                  <input type="text" id="fieldAuthorLastName" class="meta-input" placeholder="Name" />
                </label>
                <label class="author-label author-label-wide">
                  <span class="meta-key">Firma</span>
                  <input type="text" id="fieldAuthorCompany" class="meta-input" placeholder="Firma" />
                </label>
                <label class="author-label">
                  <span class="meta-key">Datum</span>
                  <div class="author-date-wrap">
                    <input type="text" id="fieldAuthorDate" class="meta-input" placeholder="TT.MM.JJJJ" />
                    <button type="button" id="btnAuthorDatePicker" class="termin-cal-btn" title="Kalender öffnen">
                      <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                      </svg>
                    </button>
                    <input type="date" id="authorDateHidden" class="author-date-hidden" tabindex="-1" aria-hidden="true" />
                  </div>
                </label>
              </div>
            </div>
          </section>

          <!-- Legende -->
          <section class="section-card section-legend" id="sectionLegend">
            <h2 class="section-title">Legende</h2>
            <div class="legend-content">
              <div class="legend-formatting">
                <h3 class="legend-subtitle">Formatierungskonventionen</h3>
                <ul class="legend-list">
                  <li><strong>Fett:</strong> Neue Punkte (im aktuellen Protokoll erstellt)</li>
                  <li><span class="text-blue">Blaue Schrift:</span> Ergänzungen und Korrekturen an bestehenden Punkten</li>
                  <li><span class="text-gray">Hellgraue Schrift:</span> Erledigte Punkte (werden mit dem übernächsten Protokoll entfernt)</li>
                </ul>
              </div>
              <div class="legend-id-syntax">
                <h3 class="legend-subtitle">ID-Syntax</h3>
                <p class="legend-syntax-text"><code>#[Protokoll-Nr]|[Kapitel].[Unterkapitel].[lfd. Punkt je Protokoll]</code></p>
                <p class="legend-syntax-example">Beispiel: <code>#11|B.1.02</code> → Protokoll Nr. 11, Kapitel B, Unterkapitel 1, Punkt 02</p>
              </div>
              <div class="legend-disclaimer">
                <h3 class="legend-subtitle">Hinweis</h3>
                <p class="legend-disclaimer-text">Der in obenstehendem Text beschriebene Besprechungsinhalt gibt das Verständnis des Verfassers wieder. Die Empfänger des Protokolls werden gebeten eventuell gewünschte Ergänzungen und/oder Korrekturen möglichst innerhalb von drei Tagen nach Zustellung beim Verfasser schriftlich anzumelden. Diese werden dann in der nächsten Besprechung dokumentiert. Ohne Einwände wird von einer ordnungsgemäßen Besprechungswiedergabe ausgegangen. Das Protokoll wird regelmäßig durch Entfall älterer und nur dokumentierender Einträge bewusst gekürzt.</p>
              </div>
              <div class="legend-abbrev">
                <h3 class="legend-subtitle">Abkürzungsverzeichnis</h3>
                <div id="abbrevList" class="abbrev-list"></div>
              </div>
            </div>
          </section>

        </div><!-- /protocolView -->
      </div><!-- /workspace-content -->
    </main>
  </div><!-- /app -->

  <!-- ════════════════════════════════════════════════════════
       MODALS
  ════════════════════════════════════════════════════════ -->

  <!-- Neues Projekt -->
  <div id="modalNewProject" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Neues Projekt anlegen</h2>
        <button class="modal-close" data-close="modalNewProject">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="newProjectCode">Projektkürzel <span class="required">*</span></label>
          <input type="text" id="newProjectCode" class="form-input" placeholder="z. B. MAR" maxlength="4" style="text-transform:uppercase" />
          <span class="form-hint">2–4 Großbuchstaben, eindeutig</span>
        </div>
        <div class="form-group">
          <label class="form-label" for="newProjectName">Projektname <span class="required">*</span></label>
          <input type="text" id="newProjectName" class="form-input" placeholder="z. B. The Corneroffice, Dortmund, ME T4-2.OG" />
        </div>
        <div class="form-group">
          <label class="form-label" for="newProjectAddress">Adresse</label>
          <input type="text" id="newProjectAddress" class="form-input" placeholder="Straße, PLZ Ort" />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="newProjectOwner">Bauherr / Vermieter</label>
            <input type="text" id="newProjectOwner" class="form-input" placeholder="Grundbesitz GmbH" />
          </div>
          <div class="form-group">
            <label class="form-label" for="newProjectTenant">Mieter</label>
            <input type="text" id="newProjectTenant" class="form-input" placeholder="New Working Life GmbH" />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalNewProject">Abbrechen</button>
        <button id="btnSaveNewProject" class="btn-primary">Projekt erstellen</button>
      </div>
    </div>
  </div>

  <!-- Neues Protokoll -->
  <div id="modalNewProtocol" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Neues Protokoll</h2>
        <button class="modal-close" data-close="modalNewProtocol">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="newProtocolType">Protokolltyp <span class="required">*</span></label>
          <select id="newProtocolType" class="form-input">
            <option value="JFx Planung">JFx Planung – Planer Jour Fixe</option>
            <option value="JFx Mieter">JFx Mieter – Mieter Jour Fixe</option>
            <option value="JFx Bauherr">JFx AG/Bauherr – Auftraggeber Jour Fixe</option>
            <option value="Baubesprechung">Baubesprechung</option>
            <option value="Aktennotiz">Aktennotiz</option>
          </select>
        </div>
        <div class="form-group" id="seriesNameGroup">
          <label class="form-label" for="newProtocolSeriesName">Serienbezeichnung (optional)</label>
          <input type="text" id="newProtocolSeriesName" class="form-input"
            placeholder="z. B. JOUR FIXE Planungsteam" />
          <span class="form-hint">Gilt für alle Folgeprotokolle und kann danach nicht mehr geändert werden.</span>
        </div>
        <div class="form-group">
          <label class="form-label checkbox-label">
            <input type="checkbox" id="newProtocolContinue" class="form-checkbox" />
            <span>Vorheriges Protokoll übernehmen und Serie fortführen</span>
          </label>
          <span class="form-hint">Offene Punkte und Teilnehmerliste werden übernommen.</span>
        </div>
        <div class="form-group hidden" id="continueFromGroup">
          <label class="form-label">Fortführt</label>
          <div class="continue-from-display" id="continueFromDisplay">—</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalNewProtocol">Abbrechen</button>
        <button id="btnSaveNewProtocol" class="btn-primary">Protokoll erstellen</button>
      </div>
    </div>
  </div>

  <!-- Unterkapitel benennen -->
  <div id="modalSubchapter" class="modal-overlay hidden">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h2 class="modal-title" id="modalSubchapterTitle">Neues Unterkapitel</h2>
        <button class="modal-close" data-close="modalSubchapter">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="subchapterLabel">Bezeichnung</label>
          <input type="text" id="subchapterLabel" class="form-input" placeholder="z. B. Objektplanung" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalSubchapter">Abbrechen</button>
        <button id="btnSaveSubchapter" class="btn-primary">Erstellen</button>
      </div>
    </div>
  </div>

  <!-- Thema benennen -->
  <div id="modalTopic" class="modal-overlay hidden">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h2 class="modal-title">Neues Thema</h2>
        <button class="modal-close" data-close="modalTopic">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="topicLabel">Thema-Bezeichnung</label>
          <input type="text" id="topicLabel" class="form-input" placeholder="z. B. Bodentanks, Mieterprüfung" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalTopic">Abbrechen</button>
        <button id="btnSaveTopic" class="btn-primary">Erstellen + ersten Punkt anlegen</button>
      </div>
    </div>
  </div>

  <!-- Kapitel benennen -->
  <div id="modalChapter" class="modal-overlay hidden">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h2 class="modal-title">Neues Kapitel</h2>
        <button class="modal-close" data-close="modalChapter">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p id="chapterKeyHint" style="font-size:12px;color:var(--text-secondary);margin-bottom:10px;"></p>
        <div class="form-group">
          <label class="form-label" for="chapterLabel">Bezeichnung</label>
          <input type="text" id="chapterLabel" class="form-input" placeholder="z. B. Nachhaltigkeit" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalChapter">Abbrechen</button>
        <button id="btnSaveChapter" class="btn-primary">Erstellen</button>
      </div>
    </div>
  </div>

  <!-- Protokoll duplizieren -->
  <div id="modalDuplicate" class="modal-overlay hidden">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h2 class="modal-title">Protokoll duplizieren</h2>
        <button class="modal-close" data-close="modalDuplicate">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="duplicateName">Neuer Protokollname <span class="required">*</span></label>
          <input type="text" id="duplicateName" class="form-input" placeholder="z. B. Sondertermin Mieterausbau" />
          <span class="form-hint">Das Duplikat ist nicht Teil der ursprünglichen Serie und erhält eine eigene Nummerierung.</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalDuplicate">Abbrechen</button>
        <button id="btnSaveDuplicate" class="btn-primary">Duplizieren</button>
      </div>
    </div>
  </div>

  <!-- Projekt löschen -->
  <div id="modalDeleteProject" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Projekt löschen</h2>
        <button class="modal-close" data-close="modalDeleteProject">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p class="delete-warning">Das Projekt <strong id="deleteProjectLabel"></strong> wird mit allen Protokollen in den Papierkorb verschoben.</p>
        <div class="delete-export-hint">
          <button id="btnExportBeforeDelete" class="btn-secondary">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="vertical-align:-2px;margin-right:4px">
              <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
              <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
            </svg>
            Vorher exportieren (Backup)
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalDeleteProject">Abbrechen</button>
        <button id="btnConfirmDeleteProject" class="btn-danger">In Papierkorb verschieben</button>
      </div>
    </div>
  </div>

  <!-- Datenbank schließen -->
  <div id="modalCloseDatabase" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Datenbank schließen</h2>
        <button class="modal-close" data-close="modalCloseDatabase">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p class="delete-warning">Die gesamte Datenbank wird geleert. Alle Projekte und Protokolle werden unwiderruflich gelöscht.</p>
        <div class="delete-export-hint">
          <button id="btnExportBeforeClose" class="btn-secondary">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="vertical-align:-2px;margin-right:4px">
              <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
              <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
            </svg>
            Vorher exportieren (Backup)
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="modalCloseDatabase">Abbrechen</button>
        <button id="btnConfirmCloseDatabase" class="btn-danger">Datenbank schließen</button>
      </div>
    </div>
  </div>

  <!-- Info-Dialog -->
  <div id="modalAppInfo" class="modal-overlay hidden">
    <div class="modal modal-sm app-info-modal">
      <div class="modal-header app-info-header">
        <button class="modal-close" data-close="modalAppInfo">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
      <div class="modal-body app-info-body">
        <img src="icons/kadra-logo.png" alt="KADRA" class="app-info-logo" />
        <p class="app-info-version" id="appInfoVersion"></p>
        <p class="app-info-copyright">&copy; Hopro GmbH &amp; Co. KG</p>
        <a href="https://www.hopro.de" target="_blank" rel="noopener" class="app-info-link">www.hopro.de</a>
      </div>
    </div>
  </div>

  <input type="file" id="fileImportJson" accept=".json" class="hidden" />
  <input type="file" id="fileImportFullDB" accept=".json" class="hidden" />
  <div id="toastContainer" class="toast-container"></div>

  <!-- ── Passwort-Gate ─────────────────────────────────────── -->
  <script>
  (function() {
    const HASH = '4823abdc226c2b77aa9a279218efc682a4d973a267d8142ba3a6cb8630e6f579';

    function unlockApp() {
      document.getElementById('loginGate').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
    }

    // Bereits authentifiziert in dieser Session?
    if (sessionStorage.getItem('kadra_auth') === '1') {
      unlockApp();
    }

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const pw = document.getElementById('loginPassword').value;
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(pw));
      const hash = Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');

      if (hash === HASH) {
        sessionStorage.setItem('kadra_auth', '1');
        unlockApp();
      } else {
        document.getElementById('loginError').classList.remove('hidden');
        document.getElementById('loginPassword').value = '';
        document.getElementById('loginPassword').focus();
      }
    });
  })();
  </script>

  <script src="js/lib/jspdf.umd.min.js"></script>
  <script src="js/lib/jspdf.plugin.autotable.min.js"></script>
  <script src="js/lib/nunito-sans-fonts.js"></script>
  <script src="js/db.js"></script>
  <script src="js/pdf-export.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
